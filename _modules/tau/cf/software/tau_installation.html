<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tau.cf.software.tau_installation &mdash; TAU Commander Developer Documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0a
',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="TAU Commander Developer Documentation" href="../../../../index.html" />
    <link rel="up" title="tau.cf.software" href="../software.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><img class="rightlogo" src="../../../../_static/taulogo-large.png" alt="Logo"/><h1 class="heading"><a href="../../../../index.html">
          <span>TAU Commander Developer Documentation</span></a></h1>
        <h2 class="heading"><span>tau.cf.software.tau_installation</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for tau.cf.software.tau_installation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2015, ParaTools, Inc.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are met:</span>
<span class="c1"># (1) Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#     this list of conditions and the following disclaimer.</span>
<span class="c1"># (2) Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1">#     this list of conditions and the following disclaimer in the documentation</span>
<span class="c1">#     and/or other materials provided with the distribution.</span>
<span class="c1"># (3) Neither the name of ParaTools, Inc. nor the names of its contributors may</span>
<span class="c1">#     be used to endorse or promote products derived from this software without</span>
<span class="c1">#     specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="c1"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="c1"># FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="c1"># DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="c1"># SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="c1"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="c1"># OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c1"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;TAU software installation management.</span>

<span class="sd">TAU is the core software package of TAU Commander.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">resource</span>
<span class="kn">from</span> <span class="nn">tau</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">tau.error</span> <span class="kn">import</span> <span class="n">ConfigurationError</span><span class="p">,</span> <span class="n">InternalError</span>
<span class="kn">from</span> <span class="nn">tau.cf.software</span> <span class="kn">import</span> <span class="n">SoftwarePackageError</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.installation</span> <span class="kn">import</span> <span class="n">Installation</span><span class="p">,</span> <span class="n">parallel_make_flags</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler</span> <span class="kn">import</span> <span class="n">host</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler.host</span> <span class="kn">import</span> <span class="n">CC</span><span class="p">,</span> <span class="n">CXX</span><span class="p">,</span> <span class="n">FC</span><span class="p">,</span> <span class="n">UPC</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler.mpi</span> <span class="kn">import</span> <span class="n">MPI_CC</span><span class="p">,</span> <span class="n">MPI_CXX</span><span class="p">,</span> <span class="n">MPI_FC</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler.shmem</span> <span class="kn">import</span> <span class="n">SHMEM_CC</span><span class="p">,</span> <span class="n">SHMEM_CXX</span><span class="p">,</span> <span class="n">SHMEM_FC</span>
<span class="kn">from</span> <span class="nn">tau.cf.target</span> <span class="kn">import</span> <span class="n">TauArch</span><span class="p">,</span> <span class="n">CRAY_CNL_OS</span><span class="p">,</span> <span class="n">DARWIN_OS</span>


<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">REPOS</span> <span class="o">=</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span> <span class="s1">&#39;http://tau.uoregon.edu/tau.tgz&#39;</span><span class="p">}</span>

<span class="n">COMMANDS</span> <span class="o">=</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span> 
            <span class="p">[</span><span class="s1">&#39;jumpshot&#39;</span><span class="p">,</span>
             <span class="s1">&#39;paraprof&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfdmf_configure&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfdmf_createapp&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfdmf_createexp&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfdmfdb.py&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfdmf_loadtrial&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfexplorer&#39;</span><span class="p">,</span>
             <span class="s1">&#39;perfexplorer_configure&#39;</span><span class="p">,</span>
             <span class="s1">&#39;phaseconvert&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pprof&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ppscript&#39;</span><span class="p">,</span>
             <span class="s1">&#39;slog2print&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau2slog2&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_analyze&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taucc&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_compiler.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau-config&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_convert&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taucxx&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taudb_configure&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taudb_install_cert&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taudb_keygen&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taudb_loadtrial&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_ebs2otf.pl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_ebs_process.pl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tauex&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_exec&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_f77.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tauf90&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_f90.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_gen_wrapper&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_header_replace.pl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tauinc.pl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_java&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_javamax.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_macro.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_merge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_multimerge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_pebil_rewrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_reduce&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_rewrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_selectfile&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_show_libs&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_throttle.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_treemerge.pl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tauupc&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_upc.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tau_user_setup.sh&#39;</span><span class="p">,</span>
             <span class="s1">&#39;trace2profile&#39;</span><span class="p">]}</span>

<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Profile/Profiler.h&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile/TAU.h&#39;</span><span class="p">]}</span>

<span class="n">TAU_COMPILER_WRAPPERS</span> <span class="o">=</span> <span class="p">{</span><span class="n">CC</span><span class="p">:</span> <span class="s1">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
                         <span class="n">CXX</span><span class="p">:</span> <span class="s1">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
                         <span class="n">FC</span><span class="p">:</span> <span class="s1">&#39;tau_f90.sh&#39;</span><span class="p">,</span>
                         <span class="n">UPC</span><span class="p">:</span> <span class="s1">&#39;tau_upc.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_CC</span><span class="p">:</span> <span class="s1">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_CXX</span><span class="p">:</span> <span class="s1">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_FC</span><span class="p">:</span> <span class="s1">&#39;tau_f90.sh&#39;</span><span class="p">,</span>
                         <span class="n">SHMEM_CC</span><span class="p">:</span> <span class="s1">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
                         <span class="n">SHMEM_CXX</span><span class="p">:</span> <span class="s1">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
                         <span class="n">SHMEM_FC</span><span class="p">:</span> <span class="s1">&#39;tau_f90.sh&#39;</span><span class="p">}</span>

<span class="n">TAU_MINIMAL_COMPILERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">CC</span><span class="p">,</span> <span class="n">CXX</span><span class="p">]</span>


<div class="viewcode-block" id="TauInstallation"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation">[docs]</a><span class="k">class</span> <span class="nc">TauInstallation</span><span class="p">(</span><span class="n">Installation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulates a TAU installation.</span>
<span class="sd">    </span>
<span class="sd">    TAU is an enormous, organic, complex piece of software so this class is </span>
<span class="sd">    unusually complex to consider all the corner cases.  This is where most</span>
<span class="sd">    of the systemization of TAU is actually implemented so it can get ugly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Settle down pylint.  This is a big, ugly class and there&#39;s not much we can do about it.</span>
    <span class="c1"># pylint: disable=too-many-instance-attributes, too-many-arguments, too-many-locals, too-many-statements</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">target_arch</span><span class="p">,</span> <span class="n">target_os</span><span class="p">,</span> <span class="n">compilers</span><span class="p">,</span>
                 <span class="c1"># Application support features</span>
                 <span class="n">openmp_support</span><span class="p">,</span>
                 <span class="n">pthreads_support</span><span class="p">,</span> 
                 <span class="n">mpi_support</span><span class="p">,</span>
                 <span class="n">mpi_include_path</span><span class="p">,</span>
                 <span class="n">mpi_library_path</span><span class="p">,</span>
                 <span class="n">mpi_libraries</span><span class="p">,</span>
                 <span class="n">cuda_support</span><span class="p">,</span>
                 <span class="n">cuda_prefix</span><span class="p">,</span>
                 <span class="n">opencl_support</span><span class="p">,</span>
                 <span class="n">opencl_prefix</span><span class="p">,</span>
                 <span class="n">shmem_support</span><span class="p">,</span>
                 <span class="n">shmem_include_path</span><span class="p">,</span>
                 <span class="n">shmem_library_path</span><span class="p">,</span>
                 <span class="n">shmem_libraries</span><span class="p">,</span>
                 <span class="n">mpc_support</span><span class="p">,</span>
                 <span class="c1"># Instrumentation methods and options</span>
                 <span class="n">source_inst</span><span class="p">,</span>
                 <span class="n">compiler_inst</span><span class="p">,</span>
                 <span class="n">link_only</span><span class="p">,</span>
                 <span class="n">io_inst</span><span class="p">,</span>
                 <span class="n">keep_inst_files</span><span class="p">,</span>
                 <span class="n">reuse_inst_files</span><span class="p">,</span>
                 <span class="n">select_file</span><span class="p">,</span>
                 <span class="c1"># Measurement methods and options</span>
                 <span class="n">profile</span><span class="p">,</span>
                 <span class="n">trace</span><span class="p">,</span>
                 <span class="n">sample</span><span class="p">,</span>
                 <span class="n">metrics</span><span class="p">,</span>
                 <span class="n">measure_mpi</span><span class="p">,</span>
                 <span class="n">measure_openmp</span><span class="p">,</span>
                 <span class="n">measure_opencl</span><span class="p">,</span>
                 <span class="n">measure_cuda</span><span class="p">,</span>
                 <span class="n">measure_shmem</span><span class="p">,</span>
                 <span class="n">measure_heap_usage</span><span class="p">,</span>
                 <span class="n">measure_memory_alloc</span><span class="p">,</span>
                 <span class="n">measure_comm_matrix</span><span class="p">,</span>
                 <span class="n">callpath_depth</span><span class="p">,</span>
                 <span class="n">throttle</span><span class="p">,</span>
                 <span class="n">throttle_per_call</span><span class="p">,</span>
                 <span class="n">throttle_num_calls</span><span class="p">,</span>
		 <span class="n">forced_makefile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the TAU installation wrapper class.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            src (str): Path to a directory where a software package has already been </span>
<span class="sd">                       installed, or a path to a source archive file, or the special keyword &#39;download&#39;.</span>
<span class="sd">            target_arch (Architecture): Target architecture description.</span>
<span class="sd">            target_os (OperatingSystem): Target operating system description.</span>
<span class="sd">            compilers (InstalledCompilerSet): Compilers to use if software must be compiled.</span>
<span class="sd">            pdt_source (str): Path to PDT source, installation, or None.</span>
<span class="sd">            binutils_source (str): Path to GNU binutils source, installation, or None.</span>
<span class="sd">            libunwind_source (str): Path to libunwind source, installation, or None.</span>
<span class="sd">            papi_source (str): Path to PAPI source, installation, or None.</span>
<span class="sd">            openmp_support (bool): Enable or disable OpenMP support in TAU.</span>
<span class="sd">            pthreads_support (bool): Enable or disable pthreads support in TAU.</span>
<span class="sd">            mpi_support (bool): Enable or disable MPI support in TAU.</span>
<span class="sd">            mpi_include_path (list):  Paths to search for MPI header files. </span>
<span class="sd">            mpi_library_path (list): Paths to search for MPI library files.</span>
<span class="sd">            mpi_libraries (list): MPI libraries to include when linking with TAU.</span>
<span class="sd">            cuda_support (bool): Enable or disable CUDA support in TAU.</span>
<span class="sd">            opencl_support (bool): Enable or disable OpenCL support in TAU.</span>
<span class="sd">            shmem_support (bool): Enable or disable SHMEM support in TAU.</span>
<span class="sd">            shmem_include_path (list):  Paths to search for SHMEM header files. </span>
<span class="sd">            shmem_library_path (list): Paths to search for SHMEM library files.</span>
<span class="sd">            shmem_libraries (list): SHMEM libraries to include when linking with TAU.</span>
<span class="sd">            mpc_support (bool): Enable or disable MPC support in TAU.</span>
<span class="sd">            source_inst (bool): Enable or disable source-based instrumentation in TAU.</span>
<span class="sd">            compiler_inst (bool): Enable or disable compiler-based instrumentation in TAU. </span>
<span class="sd">            link_only (bool): True to disable instrumentation and link TAU libraries.</span>
<span class="sd">            io_inst (bool): Enable or disable POSIX I/O instrumentation in TAU.</span>
<span class="sd">            keep_inst_files (bool): If True then do not remove instrumented source files after compilation.</span>
<span class="sd">            reuse_inst_files (bool): If True then reuse instrumented source files for compilation when available.</span>
<span class="sd">            select_file (str): Path to selective instrumentation file.</span>
<span class="sd">            profile (str): Enable or disable profiling.</span>
<span class="sd">            trace (str): Enable or disable tracing.</span>
<span class="sd">            sample (bool): Enable or disable event-based sampling.</span>
<span class="sd">            metrics (list): Metrics to measure, e.g. [&#39;TIME&#39;, &#39;PAPI_FP_INS&#39;]</span>
<span class="sd">            measure_mpi (bool): If True then measure time spent in MPI calls. </span>
<span class="sd">            measure_openmp (str): String specifying OpenMP measurement method, e.g. &#39;opari&#39; or &#39;ompt&#39;</span>
<span class="sd">            measure_cuda (bool): If True then measure time spent in CUDA calls.</span>
<span class="sd">            measure_shmem (bool): If True then measure time spent in SHMEM calls.</span>
<span class="sd">            measure_heap_usage (bool): If True then measure memory usage.</span>
<span class="sd">            measure_memory_alloc (bool): If True then record memory allocation and deallocation events.</span>
<span class="sd">            measure_comm_matrix (bool): If True then record the point-to-point communication matrix.</span>
<span class="sd">            callpath_depth (int): Depth of callpath measurement.  0 to disable.</span>
<span class="sd">            throttle (bool): If True then throttle lightweight events.</span>
<span class="sd">            throttle_per_call (int): Maximum microseconds per call of a lightweight event.</span>
<span class="sd">            throttle_num_calls (int): Minimum number of calls for a lightweight event.</span>
<span class="sd">	    forced_makefile (str): Path to external makefile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;TAU Performance System&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">target_arch</span><span class="p">,</span> <span class="n">target_os</span><span class="p">,</span> 
                                              <span class="n">compilers</span><span class="p">,</span> <span class="n">REPOS</span><span class="p">,</span> <span class="n">COMMANDS</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="n">TauArch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_os</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">LOG_LEVEL</span> <span class="o">==</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span> <span class="o">=</span> <span class="n">openmp_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opencl_support</span> <span class="o">=</span> <span class="n">opencl_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opencl_prefix</span> <span class="o">=</span> <span class="n">opencl_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span> <span class="o">=</span> <span class="n">pthreads_support</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span> <span class="o">=</span> <span class="n">mpi_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span> <span class="o">=</span> <span class="n">mpi_include_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_library_path</span> <span class="o">=</span> <span class="n">mpi_library_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_libraries</span> <span class="o">=</span> <span class="n">mpi_libraries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuda_support</span> <span class="o">=</span> <span class="n">cuda_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuda_prefix</span> <span class="o">=</span> <span class="n">cuda_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span> <span class="o">=</span> <span class="n">shmem_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shmem_include_path</span> <span class="o">=</span> <span class="n">shmem_include_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shmem_library_path</span> <span class="o">=</span> <span class="n">shmem_library_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shmem_libraries</span> <span class="o">=</span> <span class="n">shmem_libraries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc_support</span> <span class="o">=</span> <span class="n">mpc_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">=</span> <span class="n">source_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">=</span> <span class="n">compiler_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_only</span> <span class="o">=</span> <span class="n">link_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span> <span class="o">=</span> <span class="n">io_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_inst_files</span> <span class="o">=</span> <span class="n">keep_inst_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuse_inst_files</span> <span class="o">=</span> <span class="n">reuse_inst_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_file</span> <span class="o">=</span> <span class="n">select_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_mpi</span> <span class="o">=</span> <span class="n">measure_mpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">=</span> <span class="n">measure_openmp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_opencl</span> <span class="o">=</span> <span class="n">measure_opencl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_cuda</span> <span class="o">=</span> <span class="n">measure_cuda</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_shmem</span> <span class="o">=</span> <span class="n">measure_shmem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_heap_usage</span> <span class="o">=</span> <span class="n">measure_heap_usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_memory_alloc</span> <span class="o">=</span> <span class="n">measure_memory_alloc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_comm_matrix</span> <span class="o">=</span> <span class="n">measure_comm_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span> <span class="o">=</span> <span class="n">callpath_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle</span> <span class="o">=</span> <span class="n">throttle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_per_call</span> <span class="o">=</span> <span class="n">throttle_per_call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_num_calls</span> <span class="o">=</span> <span class="n">throttle_num_calls</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">forced_makefile</span> <span class="o">=</span> <span class="n">forced_makefile</span>
	<span class="k">if</span> <span class="n">forced_makefile</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="s1">&#39;binutils&#39;</span><span class="p">,</span> <span class="s1">&#39;libunwind&#39;</span><span class="p">,</span> <span class="s1">&#39;papi&#39;</span><span class="p">,</span> <span class="s1">&#39;pdt&#39;</span><span class="p">:</span>
                <span class="n">uses_pkg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_uses_&#39;</span><span class="o">+</span><span class="n">pkg</span><span class="p">)</span>
	        <span class="k">if</span> <span class="n">uses_pkg</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_scorep</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;scorep&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">mpi_support</span><span class="p">,</span> <span class="n">shmem_support</span><span class="p">,</span> 
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_uses_binutils</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_libunwind</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_papi</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_pdt</span><span class="p">())</span>
	<span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="s1">&#39;binutils&#39;</span><span class="p">,</span> <span class="s1">&#39;libunwind&#39;</span><span class="p">,</span> <span class="s1">&#39;papi&#39;</span><span class="p">,</span> <span class="s1">&#39;pdt&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">sources</span><span class="p">[</span><span class="n">pkg</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;scorep&#39;</span><span class="p">]:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;scorep&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">mpi_support</span><span class="p">,</span> <span class="n">shmem_support</span><span class="p">,</span>
				<span class="n">sources</span><span class="p">[</span><span class="s1">&#39;binutils&#39;</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;libunwind&#39;</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;papi&#39;</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">&#39;pdt&#39;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_set_install_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># PDT puts installation files (bin, lib, etc.) in a magically named subfolder</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_set_install_prefix</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">arch_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arch_path</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arch_path</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_uses_pdt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TAU uses PDT to generate the SHMEM wrapper libraries, so PDT is required for SHMEM support</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">==</span> <span class="s1">&#39;automatic&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span>

    <span class="k">def</span> <span class="nf">_uses_binutils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s1">&#39;never&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ompt&#39;</span><span class="p">,</span> <span class="s1">&#39;gomp&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_uses_libunwind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_os</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DARWIN_OS</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s1">&#39;never&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_uses_papi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">met</span> <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="k">if</span> <span class="s1">&#39;PAPI&#39;</span> <span class="ow">in</span> <span class="n">met</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_uses_scorep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">==</span> <span class="s1">&#39;cubex&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">==</span> <span class="s1">&#39;otf2&#39;</span>

<div class="viewcode-block" id="TauInstallation.verify"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>

        <span class="c1"># Open TAU makefile and check BFDINCLUDE, UNWIND_INC, PAPIDIR, etc.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_makefile</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_binutils</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;BFDINCLUDE=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">binutils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="s1">&#39;binutils&#39;</span><span class="p">]</span>
                    <span class="n">bfd_inc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;-I&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">binutils</span><span class="o">.</span><span class="n">include_path</span> <span class="o">!=</span> <span class="n">bfd_inc</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;BFDINCLUDE=&#39;</span><span class="si">%s</span><span class="s2">&#39; != &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">bfd_inc</span><span class="p">,</span> <span class="n">binutils</span><span class="o">.</span><span class="n">include_path</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;BFDINCLUDE in TAU Makefile &quot;</span>
                                                   <span class="s2">&quot;doesn&#39;t match target BFD installation&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_libunwind</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;UNWIND_INC=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">libunwind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="s1">&#39;libunwind&#39;</span><span class="p">]</span>
                    <span class="n">libunwind_inc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;-I&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">libunwind</span><span class="o">.</span><span class="n">include_path</span> <span class="o">!=</span> <span class="n">libunwind_inc</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;UNWIND_INC=&#39;</span><span class="si">%s</span><span class="s2">&#39; != &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">libunwind_inc</span><span class="p">,</span> <span class="n">libunwind</span><span class="o">.</span><span class="n">include_path</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;UNWIND_INC in TAU Makefile &quot;</span>
                                                   <span class="s2">&quot;doesn&#39;t match target libunwind installation&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_papi</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;PAPIDIR=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">papi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="s1">&#39;papi&#39;</span><span class="p">]</span>
                    <span class="n">papi_dir</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span> <span class="o">!=</span> <span class="n">papi_dir</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PAPI_DIR=&#39;</span><span class="si">%s</span><span class="s2">&#39; != &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">papi_dir</span><span class="p">,</span> <span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;PAPI_DIR in TAU Makefile &quot;</span>
                                                   <span class="s2">&quot;doesn&#39;t match target PAPI installation&quot;</span><span class="p">)</span>
        <span class="c1"># Check for iowrapper</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span><span class="p">:</span>
            <span class="n">iowrap_libs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="s1">&#39;libTAU-iowrap*&#39;</span><span class="p">))</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found iowrap shared libraries: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">iowrap_libs</span><span class="p">)</span>
            <span class="n">iowrap_link_options</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="s1">&#39;wrappers&#39;</span><span class="p">,</span> <span class="s1">&#39;io_wrapper&#39;</span><span class="p">,</span> <span class="s1">&#39;link_options.tau&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">iowrap_libs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">iowrap_link_options</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;iowrap libraries or link options not found&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;TAU installation at &#39;</span><span class="si">%s</span><span class="s2">&#39; is valid&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_select_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">libglobs</span><span class="p">,</span> <span class="n">user_inc</span><span class="p">,</span> <span class="n">user_lib</span><span class="p">,</span> <span class="n">user_libraries</span><span class="p">,</span> <span class="n">wrap_cc</span><span class="p">,</span> <span class="n">wrap_cxx</span><span class="p">,</span> <span class="n">wrap_fc</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">or</span> <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">selected_inc</span><span class="p">,</span> <span class="n">selected_lib</span><span class="p">,</span> <span class="n">selected_library</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="c1"># Prefer user-specified paths over autodetected paths</span>
        <span class="n">include_path</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">user_inc</span> <span class="o">+</span> <span class="n">wrap_cc</span><span class="o">.</span><span class="n">include_path</span> <span class="o">+</span> <span class="n">wrap_cxx</span><span class="o">.</span><span class="n">include_path</span> <span class="o">+</span> <span class="n">wrap_fc</span><span class="o">.</span><span class="n">include_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_path</span><span class="p">:</span>
            <span class="c1"># Unfortunately, TAU&#39;s configure script can only accept one path on -mpiinc</span>
            <span class="c1"># and it expects the compiler&#39;s include path argument (e.g. &quot;-I&quot;) to be omitted</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">include_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="p">)):</span>
                    <span class="n">selected_inc</span> <span class="o">=</span> <span class="n">path</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not found on include path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> 
                                         <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">include_path</span><span class="p">)))</span>
        <span class="n">library_path</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">user_lib</span> <span class="o">+</span> <span class="n">wrap_cc</span><span class="o">.</span><span class="n">library_path</span> <span class="o">+</span> <span class="n">wrap_cxx</span><span class="o">.</span><span class="n">library_path</span> <span class="o">+</span> <span class="n">wrap_fc</span><span class="o">.</span><span class="n">library_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">library_path</span><span class="p">:</span>
            <span class="n">selected_lib</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">libglob</span> <span class="ow">in</span> <span class="n">libglobs</span><span class="p">:</span>
                <span class="c1"># Unfortunately, TAU&#39;s configure script can only accept one path on -mpilib</span>
                <span class="c1"># and it expects the compiler&#39;s include path argument (e.g. &quot;-L&quot;) to be omitted</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">library_path</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">libglob</span><span class="p">)):</span>
                        <span class="n">selected_lib</span> <span class="o">=</span> <span class="n">path</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_lib</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;No files matched &#39;</span><span class="si">%s</span><span class="s2">&#39; on library path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> 
                                         <span class="p">(</span><span class="n">libglobs</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">library_path</span><span class="p">)))</span>
        <span class="c1"># Don&#39;t add autodetected Fortran or C++ libraries; C is probably OK</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">user_libraries</span> <span class="o">+</span> <span class="n">wrap_cc</span><span class="o">.</span><span class="n">libraries</span> <span class="o">+</span> <span class="n">wrap_cxx</span><span class="o">.</span><span class="n">libraries</span> <span class="o">+</span> <span class="n">wrap_fc</span><span class="o">.</span><span class="n">libraries</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">libraries</span><span class="p">:</span>
            <span class="c1"># TAU&#39;s configure script accepts multiple libraries but only if they&#39;re separated by a &#39;#&#39; symbol</span>
            <span class="c1"># and the compiler&#39;s library linking flag (e.g. &#39;-l&#39;) must be included</span>
            <span class="n">link_library_flag</span> <span class="o">=</span> <span class="n">wrap_cc</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link_library_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">link_library_flag</span><span class="o">+</span><span class="n">lib</span> <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libraries</span><span class="p">]</span>
            <span class="c1"># Also jam missing library path&#39;s onto this option</span>
            <span class="n">library_path_flag</span> <span class="o">=</span> <span class="n">wrap_cc</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">library_path_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">library_path_flag</span><span class="o">+</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">library_path</span> <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="n">selected_lib</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span>
            <span class="n">selected_library</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">selected_inc</span><span class="p">,</span> <span class="n">selected_lib</span><span class="p">,</span> <span class="n">selected_library</span>

<div class="viewcode-block" id="TauInstallation.configure"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures TAU</span>
<span class="sd">        </span>
<span class="sd">        Executes TAU&#39;s configuration script with appropriate arguments to support the specified configuration.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwareConfigurationError: TAU&#39;s configure script failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TAU&#39;s configure script can&#39;t cope with compiler absolute paths or compiler names that</span>
        <span class="c1"># don&#39;t exactly match what it expects.  Use `info.command` instead of `command` to work</span>
        <span class="c1"># around these problems e.g. &#39;gcc-4.9&#39; becomes &#39;gcc&#39;. </span>
        <span class="c1"># Also, TAU&#39;s configure script does a really bad job detecting wrapped compiler commands</span>
        <span class="c1"># so we unwrap the wrapper here before invoking configure.</span>
        <span class="n">cc_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CC</span><span class="p">]</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
        <span class="n">cxx_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX</span><span class="p">]</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
        <span class="n">fc_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">FC</span><span class="p">]</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span> <span class="k">if</span> <span class="n">FC</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="c1"># TAU&#39;s configure script can&#39;t detect Fortran compiler from the compiler</span>
        <span class="c1"># command so translate Fortran compiler command into TAU&#39;s magic words</span>
        <span class="n">fortran_magic</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">fc_comp</span><span class="p">:</span>
            <span class="n">fc_family</span> <span class="o">=</span> <span class="n">fc_comp</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span>
            <span class="n">fc_magic_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">host</span><span class="o">.</span><span class="n">GNU</span><span class="p">:</span> <span class="s1">&#39;gfortran&#39;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">.</span><span class="n">INTEL</span><span class="p">:</span> <span class="s1">&#39;intel&#39;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">.</span><span class="n">PGI</span><span class="p">:</span> <span class="s1">&#39;pgi&#39;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">.</span><span class="n">CRAY</span><span class="p">:</span> <span class="s1">&#39;cray&#39;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">.</span><span class="n">IBM</span><span class="p">:</span> <span class="s1">&#39;ibm&#39;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">.</span><span class="n">IBM_BG</span><span class="p">:</span> <span class="s1">&#39;ibm&#39;</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fortran_magic</span> <span class="o">=</span> <span class="n">fc_magic_map</span><span class="p">[</span><span class="n">fc_family</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t determine TAU magic word for </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fc_comp</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">short_descr</span><span class="p">,</span> <span class="n">fc_comp</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Unknown compiler family for Fortran: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">fc_family</span><span class="p">)</span>

        <span class="c1"># Set up MPI paths and libraries</span>
        <span class="n">mpiinc</span><span class="p">,</span> <span class="n">mpilib</span><span class="p">,</span> <span class="n">mpilibrary</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
            <span class="n">mpiinc</span><span class="p">,</span> <span class="n">mpilib</span><span class="p">,</span> <span class="n">mpilibrary</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_flags</span><span class="p">(</span><span class="s1">&#39;mpi.h&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;libmpi*&#39;</span><span class="p">,),</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">mpi_library_path</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">mpi_libraries</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_CC</span><span class="p">],</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_CXX</span><span class="p">],</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_FC</span><span class="p">])</span>
        
        <span class="c1"># Set up SHMEM paths and libraries</span>
        <span class="n">shmeminc</span><span class="p">,</span> <span class="n">shmemlib</span><span class="p">,</span> <span class="n">shmemlibrary</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span><span class="p">:</span>
            <span class="n">shmeminc</span><span class="p">,</span> <span class="n">shmemlib</span><span class="p">,</span> <span class="n">shmemlibrary</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_flags</span><span class="p">(</span><span class="s1">&#39;shmem.h&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;lib*shmem*&#39;</span><span class="p">,</span> <span class="s1">&#39;lib*sma*&#39;</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">shmem_include_path</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">shmem_library_path</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">shmem_libraries</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">SHMEM_CC</span><span class="p">],</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">SHMEM_CXX</span><span class="p">],</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">SHMEM_FC</span><span class="p">])</span>
        
        <span class="n">binutils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binutils&#39;</span><span class="p">)</span>
        <span class="n">libunwind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libunwind&#39;</span><span class="p">)</span>
        <span class="n">papi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;papi&#39;</span><span class="p">)</span>
        <span class="n">pdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pdt&#39;</span><span class="p">)</span>
        <span class="n">scorep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scorep&#39;</span><span class="p">)</span>
        
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span>
                 <span class="p">[</span><span class="s1">&#39;-arch=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span>
                  <span class="s1">&#39;-cc=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cc_command</span><span class="p">,</span>
                  <span class="s1">&#39;-c++=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cxx_command</span><span class="p">,</span>
                  <span class="s1">&#39;-fortran=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fortran_magic</span> <span class="k">if</span> <span class="n">fortran_magic</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-bfd=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">binutils</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="n">binutils</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-papi=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="n">papi</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-unwind=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">libunwind</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="n">libunwind</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-scorep=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">scorep</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="n">scorep</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-pthread&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-mpi&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-mpiinc=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mpiinc</span> <span class="k">if</span> <span class="n">mpiinc</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-mpilib=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mpilib</span> <span class="k">if</span> <span class="n">mpilib</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-mpilibrary=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mpilibrary</span> <span class="k">if</span> <span class="n">mpilibrary</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-cuda=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda_prefix</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-opencl=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">opencl_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opencl_prefix</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-shmem&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-shmeminc=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shmeminc</span> <span class="k">if</span> <span class="n">shmeminc</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-shmemlib=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shmemlib</span> <span class="k">if</span> <span class="n">shmemlib</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="s1">&#39;-shmemlibrary=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shmemlibrary</span> <span class="k">if</span> <span class="n">shmemlibrary</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="p">]</span> <span class="k">if</span> <span class="n">flag</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pdt</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-pdt=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pdt</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-pdt_c++=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pdt</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-openmp&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s1">&#39;ompt&#39;</span><span class="p">:</span>
                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-ompt=download&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s1">&#39;opari&#39;</span><span class="p">:</span>
                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-opari&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-iowrapper&#39;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./configure&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">flags</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Configuring TAU...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_prefix</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s1">&#39;TAU configure failed&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TauInstallation.make_install"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.make_install">[docs]</a>    <span class="k">def</span> <span class="nf">make_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Installs TAU to ``self.install_prefix``.</span>
<span class="sd">        </span>
<span class="sd">        Executes &#39;make install&#39; to build and install TAU.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwarePackageError: &#39;make install&#39; failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">parallel_make_flags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compiling and installing TAU...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_prefix</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s1">&#39;TAU compilation/installation failed&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TauInstallation.install"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.install">[docs]</a>    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reinstall</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Installs TAU.</span>
<span class="sd">        </span>
<span class="sd">        Configures, compiles, and installs TAU with all necessarry makefiles and libraries.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            force_reinstall (bool): Set to True to force reinstall even if TAU is already installed and working.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwarePackageError: TAU failed installation or did not pass verification after it was installed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">activate_debug_log</span><span class="p">()</span>
	<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">force_reinstall</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_makefile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">pkg</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">force_reinstall</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">SoftwarePackageError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> source package is unavailable and the installation at &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span>
                                               <span class="s2">&quot;is invalid: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span> <span class="n">err</span><span class="p">),</span>
                                               <span class="s2">&quot;Specify source code path or URL to enable package reinstallation.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">force_reinstall</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_set_install_prefix</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forced_makefile</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)))</span>
	    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
		    <span class="n">pkg</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">force_reinstall</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	    <span class="k">return</span> <span class="bp">True</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Installing </span><span class="si">%s</span><span class="s2"> at &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>       
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Keep reconfiguring the same source because that&#39;s how TAU works</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_path</span><span class="p">)):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepare_src</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">src_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_install</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> installation failed: </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Verify the new installation</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Verifying </span><span class="si">%s</span><span class="s2"> installation...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span></div>

<div class="viewcode-block" id="TauInstallation.get_tags"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.get_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get tags for this TAU installation.</span>

<span class="sd">        Each TAU configuration (makefile, library, Python bindings, etc.) is identified by its tags.</span>
<span class="sd">        Tags can appear in the makefile name in any order so the order of the tags returned by this </span>
<span class="sd">        function will likely not match the order they appear in the makefile name or tau_exec command line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Makefile tags, e.g. [&#39;papi&#39;, &#39;pdt&#39;, &#39;icpc&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cxx_compiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX</span><span class="p">]</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span> 
        <span class="n">compiler_tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">host</span><span class="o">.</span><span class="n">INTEL</span><span class="p">:</span> <span class="s1">&#39;intel&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_os</span> <span class="o">==</span> <span class="n">CRAY_CNL_OS</span> <span class="k">else</span> <span class="s1">&#39;icpc&#39;</span><span class="p">,</span> 
                         <span class="n">host</span><span class="o">.</span><span class="n">PGI</span><span class="p">:</span> <span class="s1">&#39;pgi&#39;</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compiler_tags</span><span class="p">[</span><span class="n">cxx_compiler</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_pdt</span><span class="p">():</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pdt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_papi</span><span class="p">():</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;papi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_scorep</span><span class="p">():</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scorep&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;openmp&#39;</span><span class="p">)</span>
            <span class="n">openmp_tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ompt&#39;</span><span class="p">:</span> <span class="s1">&#39;ompt&#39;</span><span class="p">,</span> <span class="s1">&#39;opari&#39;</span><span class="p">:</span> <span class="s1">&#39;opari&#39;</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">openmp_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pthread&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mpi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cupti&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;shmem&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpc_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mpc&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;TAU tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TauInstallation._incompatible_tags"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation._incompatible_tags">[docs]</a>    <span class="k">def</span> <span class="nf">_incompatible_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a set of makefile tags incompatible with the specified config.&quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cxx_compiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX</span><span class="p">]</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
        <span class="n">compiler_tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">host</span><span class="o">.</span><span class="n">INTEL</span><span class="p">:</span> <span class="s1">&#39;intel&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_os</span> <span class="o">==</span> <span class="n">CRAY_CNL_OS</span> <span class="k">else</span> <span class="s1">&#39;icpc&#39;</span><span class="p">,</span> 
                         <span class="n">host</span><span class="o">.</span><span class="n">PGI</span><span class="p">:</span> <span class="s1">&#39;pgi&#39;</span><span class="p">}</span>
        <span class="n">compiler_tag</span> <span class="o">=</span> <span class="n">compiler_tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cxx_compiler</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tag</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">compiler_tags</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()</span> <span class="k">if</span> <span class="n">tag</span> <span class="o">!=</span> <span class="n">compiler_tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mpi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">!=</span> <span class="s1">&#39;opari&#39;</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;opari&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;openmp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_scorep</span><span class="p">():</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scorep&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;shmem&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Incompatible tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>

<div class="viewcode-block" id="TauInstallation.get_makefile"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.get_makefile">[docs]</a>    <span class="k">def</span> <span class="nf">get_makefile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an absolute path to a TAU_MAKEFILE.</span>

<span class="sd">        The file returned *should* supply all requested measurement features </span>
<span class="sd">        and application support features specified in the constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A file path that could be used to set the TAU_MAKEFILE environment</span>
<span class="sd">                 variable, or None if a suitable makefile couldn&#39;t be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_makefile</span><span class="p">:</span>
	    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_makefile</span>
        <span class="n">tau_makefiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="s1">&#39;Makefile.tau*&#39;</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found makefiles: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">tau_makefiles</span><span class="p">)</span>
        <span class="n">config_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Searching for makefile with tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="n">approx_tags</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">approx_makefile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dangerous_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incompatible_tags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Will not use makefiles containing tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dangerous_tags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">makefile</span> <span class="ow">in</span> <span class="n">tau_makefiles</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">makefile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">config_tags</span> <span class="o">&lt;=</span> <span class="n">tags</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> contains desired tags: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tags</span> <span class="o">&lt;=</span> <span class="n">config_tags</span><span class="p">:</span>
                    <span class="n">makefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span> 
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found TAU makefile </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">makefile</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">tags</span> <span class="o">&amp;</span> <span class="n">dangerous_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">approx_tags</span> <span class="ow">or</span> <span class="n">tags</span> <span class="o">&lt;</span> <span class="n">approx_tags</span><span class="p">:</span>
                        <span class="n">approx_makefile</span> <span class="o">=</span> <span class="n">makefile</span>
                        <span class="n">approx_tags</span> <span class="o">=</span> <span class="n">tags</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Best approximate match is: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">approx_tags</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No TAU makefile exactly matches tags &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">approx_makefile</span><span class="p">:</span>
            <span class="n">makefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">approx_makefile</span><span class="p">)</span> 
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found approximate match with TAU makefile </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">makefile</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No TAU makefile approximately matches tags &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s2">&quot;TAU Makefile not found for tags &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> 
                                   <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_tags</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unsets any TAU environment variables that were set by the user.</span>
<span class="sd">        </span>
<span class="sd">        A user&#39;s preexisting TAU configuration may conflict with the configuration</span>
<span class="sd">        specified by the TAU Commander project.  This routine lets us work in a</span>
<span class="sd">        clean environment without disrupting the user&#39;s shell environment.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: `env` without TAU environment variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">is_tau_var</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TAU_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SCOREP_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;PROFILEDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;TRACEDIR&#39;</span><span class="p">)</span>
        <span class="n">dirt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_tau_var</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="k">if</span> <span class="n">dirt</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ignoring TAU environment variables set in user&#39;s environment:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dirt</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirt</span><span class="p">])</span>
    
<div class="viewcode-block" id="TauInstallation.compiletime_config"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.compiletime_config">[docs]</a>    <span class="k">def</span> <span class="nf">compiletime_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures environment for compilation with TAU.</span>

<span class="sd">        Modifies incoming command line arguments and environment variables</span>
<span class="sd">        for the TAU compiler wrapper scripts.</span>

<span class="sd">        Args:</span>
<span class="sd">            opts (list): Command line options.</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (opts, env) updated to support TAU.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="n">pkg</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_OPTIONS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">tau_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optRevert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optVerbose&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s1">&#39;always&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optCompInst&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optNoCompInst&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s1">&#39;fallback&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optRevert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_only</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optLinkOnly&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_inst_files</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optKeepFiles&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_inst_files</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optReuseFiles&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_file</span><span class="p">:</span>
            <span class="n">select_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_file</span><span class="p">))</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optTauSelectFile=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">select_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optTrackIO&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_memory_alloc</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;-optMemDbg&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_tau_options</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_MAKEFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_makefile</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_OPTIONS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tau_opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="p">)),</span> <span class="n">env</span></div>


<div class="viewcode-block" id="TauInstallation.runtime_config"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.runtime_config">[docs]</a>    <span class="k">def</span> <span class="nf">runtime_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures environment for execution with TAU.</span>
<span class="sd">        </span>
<span class="sd">        Modifies incoming command line arguments and environment variables </span>
<span class="sd">        for the TAU library and tau_exec script.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            opts (list): Command line options.</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (opts, env) updated to support TAU.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_VERBOSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">==</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">==</span> <span class="s1">&#39;merged&#39;</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_PROFILE_FORMAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;merged&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">==</span> <span class="s1">&#39;cubex&#39;</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;SCOREP_ENABLE_PROFILING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">==</span> <span class="s1">&#39;slog2&#39;</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">==</span> <span class="s1">&#39;otf2&#39;</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;SCOREP_ENABLE_TRACING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_SAMPLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_TRACK_HEAP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_heap_usage</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_COMM_MATRIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_comm_matrix</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_METRICS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_THROTTLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throttle</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">throttle</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_THROTTLE_PERCALL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throttle_per_call</span><span class="p">))</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_THROTTLE_NUMCALLS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throttle_num_calls</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_CALLPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_CALLPATH_DEPTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-ebs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_cuda</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-cupti&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_opencl</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-opencl&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-io&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_memory_alloc</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;TAU_SHOW_MEMORY_FUNCTIONS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_shmem</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-shmem&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="p">)),</span> <span class="n">env</span></div>

<div class="viewcode-block" id="TauInstallation.get_compiler_command"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.get_compiler_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_compiler_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the compiler wrapper command for the given compiler.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            compiler (InstalledCompiler): A compiler to find a wrapper for.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Command for TAU compiler wrapper without path or arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">use_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">!=</span> <span class="s1">&#39;never&#39;</span> <span class="ow">or</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s1">&#39;never&#39;</span> <span class="ow">or</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">target_os</span> <span class="ow">is</span> <span class="n">CRAY_CNL_OS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_wrapper</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TAU_COMPILER_WRAPPERS</span><span class="p">[</span><span class="n">compiler</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">role</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">absolute_path</span></div>

<div class="viewcode-block" id="TauInstallation.compile"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">compiler_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes a compilation command.</span>
<span class="sd">        </span>
<span class="sd">        Sets TAU environment variables and configures TAU compiler wrapper</span>
<span class="sd">        command line arguments to match specified configuration, then</span>
<span class="sd">        executes the compiler command. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            compiler (Compiler): A compiler command.</span>
<span class="sd">            compiler_args (list): Compiler command line arguments.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ConfigurationError: Compilation failed.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: Compiler return value (always 0 if no exception raised). </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">()</span>
        <span class="n">compiler_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compiler_command</span><span class="p">(</span><span class="n">compiler</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">compiler_cmd</span><span class="p">]</span> <span class="o">+</span> <span class="n">opts</span> <span class="o">+</span> <span class="n">compiler_args</span>
        <span class="n">tau_env_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TAU_&#39;</span><span class="p">)]</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tau_env_opts</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;TAU was unable to build the application.&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;Check that the application builds with its normal compilers, i.e. without TAU.&quot;</span>
                                     <span class="s2">&quot;Use tau --log and see detailed output at the end of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">logger</span><span class="o">.</span><span class="n">LOG_FILE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>

<div class="viewcode-block" id="TauInstallation.get_application_command"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.get_application_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_application_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launcher_cmd</span><span class="p">,</span> <span class="n">application_cmd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a command line to launch an application under TAU.</span>
<span class="sd">        </span>
<span class="sd">        Sometimes TAU needs to use tau_exec, sometimes not.  This routine</span>
<span class="sd">        also handles backend launch commands like `aprun`.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">            launcher_cmd (list): Application launcher with command line arguments, e.g. [&#39;mpirun&#39;, &#39;-np&#39;, &#39;4&#39;].</span>
<span class="sd">            application_cmd (list): Application command with command line arguments, e.g. [&#39;./a.out&#39;, &#39;-g&#39;, &#39;hello&#39;].</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (cmd, env) where `cmd` is the new command line and `env` is a dictionary of environment </span>
<span class="sd">                   variables to set before running the application command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="n">use_tau_exec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_opencl</span> <span class="ow">or</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_only</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">use_tau_exec</span><span class="p">:</span>
            <span class="n">tau_exec_opts</span> <span class="o">=</span> <span class="n">opts</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;serial&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opencl_support</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;cupti&#39;</span><span class="p">)</span>
            <span class="n">tau_exec</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tau_exec&#39;</span><span class="p">,</span> <span class="s1">&#39;-T&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags</span><span class="p">)]</span> <span class="o">+</span> <span class="n">tau_exec_opts</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">launcher_cmd</span> <span class="o">+</span> <span class="n">tau_exec</span> <span class="o">+</span> <span class="n">application_cmd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">launcher_cmd</span> <span class="o">+</span> <span class="n">application_cmd</span>
        <span class="k">return</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">env</span></div>

<div class="viewcode-block" id="TauInstallation.show_profile"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.show_profile">[docs]</a>    <span class="k">def</span> <span class="nf">show_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tool_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows profile data in the specified file or folder.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the directory containing profile files or MULTI__ directories.</span>
<span class="sd">            tool_name (str): Name of the profile visualization tool to use, e.g. &#39;pprof&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: Return code of the visualization tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Showing profile files at &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tool_name</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;paraprof&#39;</span><span class="p">,</span> <span class="s1">&#39;pprof&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pfile</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tauprofile.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;profile.cubex&#39;</span><span class="p">]:</span>
                <span class="n">ppath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pfile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ppath</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ppath</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ppath</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="p">,</span> <span class="n">ppath</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="p">]</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Opening </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ppath</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> failed&quot;</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;All visualization or reporting tools failed to open &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span>
                                     <span class="s2">&quot;Check Java installation, X11 installation,&quot;</span>
                                     <span class="s2">&quot; network connectivity, and file permissions&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TauInstallation.show_trace"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.show_trace">[docs]</a>    <span class="k">def</span> <span class="nf">show_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tool_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows trace data in the specified file or folder.</span>
<span class="sd">        </span>
<span class="sd">        Merges the traces and converts them if needed.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the directory containing trace files.</span>
<span class="sd">            tool_name (str): Name of the profile visualization tool to use, e.g. &#39;vampir&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: Return code of the visualization tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Showing trace files at &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">==</span> <span class="s1">&#39;otf2&#39;</span> <span class="ow">and</span> <span class="n">tool_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tool_name</span> <span class="o">=</span> <span class="s1">&#39;vampir&#39;</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;otf2 requires vampir&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tool_name</span> <span class="o">=</span> <span class="s1">&#39;jumpshot&#39;</span>
        <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;jumpshot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Individual trace files not yet supported.&quot;</span><span class="p">)</span>
            <span class="n">tau_slog2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;tau.slog2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tau_slog2</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;tau.trc&#39;</span><span class="p">)):</span>
                    <span class="n">trc_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.trc&#39;</span><span class="p">))</span>
                    <span class="n">edf_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.edf&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">trc_files</span> <span class="ow">and</span> <span class="n">edf_files</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;No *.trc or *.edf files!&quot;</span><span class="p">)</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tau_treemerge.pl&#39;</span><span class="p">]</span>
                    <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Nonzero return code from tau_treemerge.pl&quot;</span><span class="p">)</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tau2slog2&#39;</span><span class="p">,</span> <span class="s1">&#39;tau.trc&#39;</span><span class="p">,</span> <span class="s1">&#39;tau.edf&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;tau.slog2&#39;</span><span class="p">]</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Nonzero return code from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Opening </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tau_slog2</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">tau_slog2</span><span class="p">]</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;vampir&#39;</span> <span class="ow">or</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;vampirserver&#39;</span><span class="p">:</span>
            <span class="n">tau_otf2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;traces.otf2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tau_otf2</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;otf2 trace files not found.&quot;</span><span class="p">)</span>
            <span class="n">evt_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;traces/*.evt&#39;</span><span class="p">))</span>
            <span class="n">def_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;traces/*.def&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">evt_files</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">def_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_NOFILE</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Too many trace files, use Vampir server to view.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">util</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;vampir&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Vampir not found in PATH. Contact ParaTools for more information on Vampir.&quot;</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Opening </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tau_otf2</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">tau_otf2</span><span class="p">]</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Only vampir and jumpshot supported at this time&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Trace visualizer failed to open &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span>
                                     <span class="s2">&quot;Check Java installation, X11 installation,&quot;</span>
                                     <span class="s2">&quot; network connectivity, and file permissions&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TauInstallation.pack_profiles"><a class="viewcode-back" href="../../../../tau.cf.software.tau_installation.html#tau.cf.software.tau_installation.TauInstallation.pack_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">pack_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">ppk_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a PPK file from profile.* files.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            prefix (str): Path to the directory containing profile.* files.</span>
<span class="sd">            ppk_file (str): Absolute path to the PPK file that will be created.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ConfigurationError: paraprof failed to pack the profiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;paraprof&#39;</span><span class="p">,</span> <span class="s1">&#39;--pack&#39;</span><span class="p">,</span> <span class="n">ppk_file</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;ParaProf command &#39;</span><span class="si">%s</span><span class="s2">&#39; failed in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">prefix</span><span class="p">),</span>
                                     <span class="s2">&quot;Make sure Java is installed and working&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;Install the most recent Java from http://java.com&quot;</span><span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015 ParaTools, Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>